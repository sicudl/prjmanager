import{resolveComponent as e,openBlock as t,createBlock as l,withCtx as n,createElementVNode as i,createVNode as a,createTextVNode as o}from"vue";import{useApi as s}from"@directus/extensions-sdk";var d={data:()=>({collections:null,selectedProject:null,projects:[],selectedStakeholders:[],stakeholders:[],title:"",body:"",comunicationSent:!1,comunicationError:!1}),methods:{projectChanged:function(e){console.log("Changed")},sendComunication:function(){var e={title:this.title,body:this.body,project_id:this.selectedProject,recipients:this.selectedStakeholders.map((e=>({stakeholders_id:e})))};this.api.post("/items/comunication",e).then((e=>{this.title="",this.body="",this.selectedStakeholders=[],this.comunicationSent=!0})).catch((e=>{}))},loadStakeholders:function(e){this.api.get("/items/stakeholders?limit=-1&filter[project_id][_eq]="+e).then((e=>{this.selectedStakeholders=[],this.stakeholders=e.data.data}))}},watch:{selectedProject:function(e){this.loadStakeholders(e)}},inject:["api"],mounted(){this.api.get("/items/project?limit=-1").then((e=>{if(this.projects=e.data.data,this.$route.query.id){this.projects.find((e=>e.id===parseInt(this.$route.query.id)))&&(this.selectedProject=parseInt(this.$route.query.id))}})),console.log("selectedProject",this.selectedProject)}};const r={class:"form grid with-fill"},c={class:"field full"},u=i("div",{class:"label type-label"},[i("span",null,"Projecte:")],-1),m={class:"field full"},p=i("div",{class:"label type-label"},[i("span",null,"Interessats/des:")],-1),f={class:"field full"},h=i("div",{class:"label type-label"},[i("span",null,"Assumpte:")],-1),v={class:"field full"},b=i("div",{class:"label type-label"},[i("span",null,"Cos:")],-1),g={class:"field full"},y=o("Click me!"),j=i("h2",null,"La comunicació s'ha enviat correctament",-1),k=o("Ok");var x=[],S=[];!function(e,t){if(e&&"undefined"!=typeof document){var l,n=!0===t.prepend?"prepend":"append",i=!0===t.singleTag,a="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(i){var o=x.indexOf(a);-1===o&&(o=x.push(a)-1,S[o]={}),l=S[o]&&S[o][n]?S[o][n]:S[o][n]=s()}else l=s();65279===e.charCodeAt(0)&&(e=e.substring(1)),l.styleSheet?l.styleSheet.cssText+=e:l.appendChild(document.createTextNode(e))}function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var l=Object.keys(t.attributes),i=0;i<l.length;i++)e.setAttribute(l[i],t.attributes[l[i]]);var o="prepend"===n?"afterbegin":"beforeend";return a.insertAdjacentElement(o,e),e}}("\n.form {\n\tdisplay: grid;\n\tpadding: var(--content-padding);\n    padding-bottom: var(--content-padding-bottom);\n\tgap: var(--form-vertical-gap) var(--form-horizontal-gap);\n}\n.with-fill {\n\tgrid-template-columns: [start] minmax(0,var(--form-column-max-width)) [half] minmax(0,var(--form-column-max-width)) [full] 1fr [fill];\n}\n.field {\n\t    position: relative;\n}\n.form .full{\n\tgrid-column: start/full;\n}\n.label {\n    position: relative;\n    display: flex;\n    width: max-content;\n    margin-bottom: 8px;\n    cursor: pointer;\n}\n.type-label {\n    color: var(--foreground-normal-alt);\n    font-weight: 600;\n    font-size: 16px;\n    font-family: var(--family-sans-serif);\n    font-style: normal;\n    line-height: 19px;\n}\n",{}),d.render=function(o,s,d,x,S,V){const C=e("v-select"),_=e("v-input"),P=e("v-textarea"),w=e("v-button"),q=e("v-sheet"),A=e("v-dialog"),E=e("private-view");return t(),l(E,{title:"Envia una comunicació"},{default:n((()=>[i("div",r,[i("div",c,[u,a(C,{"item-text":"name","item-value":"id",modelValue:S.selectedProject,"onUpdate:modelValue":s[0]||(s[0]=e=>S.selectedProject=e),items:S.projects},null,8,["modelValue","items"])]),i("div",m,[p,a(C,{label:"Interessats","item-text":"name","item-value":"id",modelValue:S.selectedStakeholders,"onUpdate:modelValue":s[1]||(s[1]=e=>S.selectedStakeholders=e),multiple:"true",items:S.stakeholders},null,8,["modelValue","items"])]),i("div",f,[h,a(_,{modelValue:S.title,"onUpdate:modelValue":s[2]||(s[2]=e=>S.title=e)},null,8,["modelValue"])]),i("div",v,[b,a(P,{modelValue:S.body,"onUpdate:modelValue":s[3]||(s[3]=e=>S.body=e)},null,8,["modelValue"])]),i("div",g,[a(w,{onClick:V.sendComunication},{default:n((()=>[y])),_:1},8,["onClick"])])]),a(A,{modelValue:S.comunicationSent,"onUpdate:modelValue":s[5]||(s[5]=e=>S.comunicationSent=e)},{default:n((()=>[a(q,null,{default:n((()=>[j,a(w,{onClick:s[4]||(s[4]=e=>S.comunicationSent=!1)},{default:n((()=>[k])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})},d.__file="module.vue";var V={id:"comunications",name:"Comunications",icon:"mail",routes:[{path:"",component:d}],setup(){s()}};export{V as default};
